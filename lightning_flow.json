[
    {
        "id": "lightning_alert_flow",
        "type": "tab",
        "label": "âš¡ï¸ ÐžÐ¿Ð¾Ð²ÐµÑ‰ÐµÐ½Ð¸Ðµ Ð¾ Ð¼Ð¾Ð»Ð½Ð¸Ð¸",
        "disabled": false,
        "info": "ÐŸÐ¾Ñ‚Ð¾Ðº Ð´Ð»Ñ Ð¾Ð¿Ð¾Ð²ÐµÑ‰ÐµÐ½Ð¸Ð¹ Ð¾ Ð³Ñ€Ð¾Ð·Ð¾Ð²Ñ‹Ñ… Ñ€Ð°Ð·Ñ€ÑÐ´Ð°Ñ…"
    },
    {
        "id": "lightning_trigger_node",
        "type": "server-state-changed",
        "z": "lightning_alert_flow",
        "name": "ÐžÑ‚ÑÐ»ÐµÐ¶Ð¸Ð²Ð°Ð½Ð¸Ðµ ÑƒÐ´Ð°Ñ€Ð° Ð¼Ð¾Ð»Ð½Ð¸Ð¸",
        "server": "79fe7aa8.47ef74",
        "version": 3,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "sensor.gw2000a_last_lightning_strike",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 1,
        "output_only_on_state_change": true,
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "x": 200,
        "y": 100,
        "wires": [
            ["lightning_sensor_node"]
        ]
    },
    {
        "id": "lightning_sensor_node",
        "type": "api-current-state",
        "z": "lightning_alert_flow",
        "name": "Ð Ð°ÑÑÑ‚Ð¾ÑÐ½Ð¸Ðµ Ð´Ð¾ Ð¼Ð¾Ð»Ð½Ð¸Ð¸",
        "server": "79fe7aa8.47ef74",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.gw2000a_lightning_strike_distance",
        "state_type": "num",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "x": 400,
        "y": 100,
        "wires": [
            ["lightning_filter"]
        ]
    },
    {
        "id": "lightning_filter",
        "type": "function",
        "z": "lightning_alert_flow",
        "name": "Ð¤Ð¸Ð»ÑŒÑ‚Ñ€ Ñ€Ð°ÑÑÑ‚Ð¾ÑÐ½Ð¸Ñ",
        "func": "const distance = Number(msg.payload);\n\nif (distance > 0 && distance <= 10) {\n    return msg;\n}\n\nreturn null;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 600,
        "y": 100,
        "wires": [
            ["lightning_telegram_message"]
        ]
    },
    {
        "id": "lightning_telegram_message",
        "type": "function",
        "z": "lightning_alert_flow",
        "name": "Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾ Ð¼Ð¾Ð»Ð½Ð¸Ð¸",
        "func": "const distance = Number(msg.payload);\n\nmsg.payload = {\n    chatId: env.get('TELEGRAM_CHAT_ID') || '-1001548038296',\n    type: 'message',\n    content: `âš¡ï¸ *Ð’ÐÐ˜ÐœÐÐÐ˜Ð•: ÐœÐ¾Ð»Ð½Ð¸Ñ!*\n\nðŸŒ©ï¸ ÐžÐ±Ð½Ð°Ñ€ÑƒÐ¶ÐµÐ½ Ð³Ñ€Ð¾Ð·Ð¾Ð²Ð¾Ð¹ Ñ€Ð°Ð·Ñ€ÑÐ´ Ð½Ð° Ñ€Ð°ÑÑÑ‚Ð¾ÑÐ½Ð¸Ð¸ *${distance} ÐºÐ¼*\n\nâš ï¸ Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÑ‚ÑÑ ÑÐ¾Ð±Ð»ÑŽÐ´Ð°Ñ‚ÑŒ Ð¼ÐµÑ€Ñ‹ Ð¿Ñ€ÐµÐ´Ð¾ÑÑ‚Ð¾Ñ€Ð¾Ð¶Ð½Ð¾ÑÑ‚Ð¸!`\n};\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 800,
        "y": 100,
        "wires": [
            ["lightning_telegram_sender"]
        ]
    },
    {
        "id": "lightning_telegram_sender",
        "type": "telegram sender",
        "z": "lightning_alert_flow",
        "name": "ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ Ð°Ð»ÐµÑ€Ñ‚ Ð¾ Ð¼Ð¾Ð»Ð½Ð¸Ð¸",
        "bot": "df690a6504c1e710",
        "haserroroutput": false,
        "outputs": 1,
        "x": 1000,
        "y": 100,
        "wires": [
            []
        ]
    }
] 